<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.0.js"></script>
	<script src="js/saveSvgAsPng.js"></script>
	<link rel="stylesheet" href="css/pure-min.css">
	<title>在线画角</title>
</head>
<style>
	* {
		margin: 0;
		padding: 0;
	}

	body {
		background-color: gray;
	}

	#main {
		display: flex;
		flex-direction: column;
		justify-content: center;
		width: 1366px;
		height: 750px;
		background-color: azure;
		margin: 18px auto;
	}

	#container {
		display: flex;
		flex-direction: row;
		justify-content: center;
		align-items: center;
		height: 750px;
		background-color: gainsboro;
	}

	#left {
		display: flex;
		justify-content: center;
		align-items: center;
		height: 750px;
	}

	#svgItem {
		background-color: #FFFFFF;
	}

	#right {
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
		height: 750px;
		background-color: #FFFFFF;
	}

	#formDiv {
		display: flex;
		flex-direction: row;
		justify-content: flex-start;
		align-items: flex-start;
		width: 100%;
		margin: 20px auto;
	}

	.pure-control-group {
		margin: 16px auto;
	}

	.button-success {
		color: white;
		border-radius: 4px;
		text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
	}

	.button-success {
		background: rgb(28, 184, 65);
	}
</style>

<body>
	<div id="main">
		<div id="container" class="pure-g">
			<div id="left" class="pure-u-2-3">
				<svg id="svgItem" xmlns="http://www.w3.org/2000/svg" width="500" height="500" version="1.2"
					viewBox="0 0 0 0">
					<line id="firstLine" x1="0" y1="0" x2="0" y2="0" class="lineStyle"
						style="stroke: #000000; stroke-width: 2px;" />
					<line id="secondLine" x1="0" y1="0" x2="0" y2="0" class="lineStyle"
						style="stroke: #000000; stroke-width: 2px;" />
					<path id="circleArc" x="0" y="0" d="M0,0" r="0" fill="none" class="lineStyle"
						style="stroke: #000000; stroke-width: 2px;" />
					<text id="degree" x="0" y="0">
						<tspan font-weight="bold" font-size="25px" fill="#000000">30°</tspan>
					</text>
				</svg>
			</div>

			<div id="right" class="pure-u-1-3">
				<div>
					<h3>设置要画的角的参数</h3>
				</div>
				<div id="formDiv">
					<form class="pure-form pure-form-aligned">
						<fieldset>
							<div class="pure-control-group">
								<label for="svgWidth">画布宽</label>
								<input id="svgWidth" type="tel" placeholder="500"
									oninput="value=this.value.replace(/\D/g,'')">
							</div>

							<div class="pure-control-group">
								<label for="svgHeight">画布高</label>
								<input id="svgHeight" type="tel" placeholder="500"
									oninput="value=this.value.replace(/\D/g,'')">
							</div>

							<div class="pure-control-group">
								<label for="lineLength">边长</label>
								<input id="lineLength" type="tel" placeholder="200"
									oninput="value=this.value.replace(/\D/g,'')">
							</div>

							<div class="pure-control-group">
								<label for="lineWeight">线条粗细</label>
								<input id="lineWeight" placeholder="3" type="tel" min="1" max="10"
									oninput="value=this.value.replace(/\D/g,'')">
							</div>

							<div class="pure-control-group">
								<label for="lineColor">线条颜色</label>
								<input id="lineColor" type="color" onchange="svgRefresh()">
							</div>

							<div class="pure-control-group">
								<label for="firstAngle">第一条边夹角</label>
								<input id="firstAngle" placeholder="30" type="tel" min="0" max="720" style="width: 186px;"
									oninput="value=this.value.replace(/\D/g,'')">
								<span class="arcSpan">°</span>
							</div>

							<div class="pure-control-group">
								<label for="secondAngle">第二条边夹角</label>
								<input id="secondAngle" placeholder="60" type="tel" min="0" max="720" style="width: 186px;"
									oninput="value=this.value.replace(/\D/g,'')">
								<span class="arcSpan">°</span>
							</div>

							<div class="pure-control-group" style="margin: 22px auto;">
								<label for="circleR">圆弧半径</label>
								<input id="circleR" value="40" type="range" min="20" max="60" style="width: 196px;"
									onmousemove="svgRefresh()">
							</div>

							<div class="pure-control-group" style="margin: 22px auto;">
								<label for="degreeX">角度标识x坐标</label>
								<input id="degreeX" value="310" type="range" min="0" max="500" step="5"
									style="width: 196px;" onmousemove="svgRefresh()">
							</div>

							<div class="pure-control-group" style="margin: 22px auto;">
								<label for="degreeY">角度标识y坐标</label>
								<input id="degreeY" value="185" type="range" min="0" max="500" step="5"
									style="width: 196px;" onmousemove="svgRefresh()">
							</div>

							<div class="pure-control-group" style="margin: 22px auto;">
								<label for="degreeLabelFontSize">角度标识大小</label>
								<input id="degreeLabelFontSize" value="25" type="range" min="20" max="50"
									style="width: 196px;" onmousemove="svgRefresh()">
							</div>
						</fieldset>
					</form>
				</div>
				<div>
					<button class="button-success pure-button" onclick="save()">下载 PNG 图片</button>
				</div>
			</div>
		</div>
	</div>
</body>

<script>

	function save() {
		saveSvgAsPng(document.getElementById("svgItem"), "diagram.png");
	}

	function svgRefresh() {

		var svgWidth, svgHeight, lineLength, lineWeight, firstAngle, secondAngle, circleR;

		//开始设定
		//画布大小和viewBox大小
		$("#svgWidth").val() == "" ? svgWidth = $("#svgWidth").attr("placeholder") : svgWidth = $("#svgWidth").val();
		$("#svgHeight").val() == "" ? svgHeight = $("#svgHeight").attr("placeholder") : svgHeight = $("#svgHeight").val();

		//边的样式
		//长度
		$("#lineLength").val() == "" ? lineLength = $("#lineLength").attr("placeholder") : lineLength = $("#lineLength").val();
		//线条粗细
		$("#lineWeight").val() == "" ? lineWeight = $("#lineWeight").attr("placeholder") : lineWeight = $("#lineWeight").val();
		//颜色
		lineColor = $("#lineColor").val();

		//两个角的大小
		$("#firstAngle").val() == "" ? firstAngle = $("#firstAngle").attr("placeholder") : firstAngle = $("#firstAngle").val();
		$("#secondAngle").val() == "" ? secondAngle = $("#secondAngle").attr("placeholder") : secondAngle = $("#secondAngle").val();

		//要画的角的大小
		var subAngle = secondAngle - firstAngle

		//圆弧的半径
		$("#circleR").val() == "" ? circleR = $("#circleR").attr("placeholder") : circleR = $("#circleR").val();

		//标识位置
		var degreeX = $("#degreeX").val();
		var degreeY = $("#degreeY").val();
		//标识字体大小
		var degreeLabelFontSize = $("#degreeLabelFontSize").val();

		//开始修改
		//修改画布大小
		$("#svgItem").attr("width", svgWidth);
		$("#svgItem").attr("height", svgHeight);
		document.getElementById("svgItem").setAttribute("viewBox", "0 0 " + svgWidth + " " + svgHeight);
		$("#degreeX").attr("max", svgWidth);
		$("#degreeY").attr("max", svgHeight);
		$("#degree").attr("x", degreeX);
		$("#degree").attr("y", degreeY);

		//修改边的样式
		$(".lineStyle").attr("style", "stroke: " + lineColor + "; stroke-width: " + lineWeight + "px; ")

		//画两条边
		$("#firstLine").attr("x1", svgWidth / 2);
		$("#firstLine").attr("y1", svgHeight / 2);
		$("#firstLine").attr("x2", svgWidth / 2 + Math.cos(firstAngle * Math.PI / 180) * lineLength);
		$("#firstLine").attr("y2", svgHeight / 2 - Math.sin(firstAngle * Math.PI / 180) * lineLength);
		$("#secondLine").attr("x1", svgWidth / 2);
		$("#secondLine").attr("y1", svgHeight / 2);
		$("#secondLine").attr("x2", svgWidth / 2 + Math.cos(secondAngle * Math.PI / 180) * lineLength);
		$("#secondLine").attr("y2", svgHeight / 2 - Math.sin(secondAngle * Math.PI / 180) * lineLength);

		//画圆弧
		$("#circleArc").attr("x", svgWidth / 2);
		$("#circleArc").attr("y", svgHeight / 2);
		$("#circleArc").attr("r", circleR);

		//根据角的大小设置圆弧的内外
		var arcInOutA, arcInOutB;
		if (subAngle > 0 && subAngle <= 180) {
			arcInOutA = 0;
			arcInOutB = 0;
		}
		if (subAngle > 180 && subAngle <= 360) {
			arcInOutA = 1;
			arcInOutB = 0;
		}

		$("#circleArc").attr("d", "M" + (svgWidth / 2 + Math.cos(firstAngle * Math.PI / 180) * circleR) + ", " + (svgHeight / 2 - Math.sin(firstAngle * Math.PI / 180) * circleR) + " A" + circleR + ", " + circleR + ", 0, " + arcInOutA + ", " + arcInOutB + ", " + (svgWidth / 2 + Math.cos(secondAngle * Math.PI / 180) * circleR) + ", " + (svgHeight / 2 - Math.sin(secondAngle * Math.PI / 180) * circleR));

		//标识颜色
		$("#degree tspan").attr("fill", lineColor);
		//标识字体大小
		$("#degree tspan").attr("font-size", degreeLabelFontSize + "px");
		//标识
		$("#degree tspan").text(subAngle + "°");
	}

	$(document).ready(function () {
		svgRefresh();
		$("#right input").keyup(function () {
			svgRefresh();
		});
		$("#right input").change(function () {
			svgRefresh();
		});
	})
</script>

</html>